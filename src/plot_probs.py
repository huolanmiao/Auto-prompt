from data.knowledge import KnowledgeDataset
import numpy as np
import torch

probs = np.array([[9.8436e-02, 1.0179e-01, 1.0617e-01, 2.5598e-02, 1.5850e-02, 1.0278e-01,
         5.8464e-02, 1.0635e-01, 1.0000e-04, 4.4757e-02, 1.1431e-02, 2.7190e-02,
         4.7698e-02, 1.0000e-04, 1.9550e-02, 4.5452e-02, 4.4147e-02, 6.1191e-02,
         1.0000e-04, 8.2437e-02],
        [1.6887e-02, 6.2786e-02, 1.8044e-02, 1.0000e-04, 1.1702e-01, 5.8233e-02,
         1.1335e-02, 3.2514e-02, 5.1089e-02, 4.3871e-02, 5.9232e-02, 1.1226e-02,
         1.2577e-01, 9.7314e-02, 1.0765e-02, 7.8650e-02, 6.9266e-02, 5.7879e-02,
         5.8627e-02, 1.7938e-02],
        [3.1241e-03, 5.4199e-02, 2.9452e-02, 7.6968e-02, 5.7279e-02, 5.2930e-02,
         7.7210e-02, 7.4233e-02, 7.1760e-03, 1.0000e-04, 1.0000e-04, 5.1840e-02,
         9.7815e-02, 6.3646e-02, 7.0628e-02, 5.3603e-02, 3.3578e-03, 4.8974e-02,
         6.1288e-02, 1.1542e-01],
        [1.0000e-04, 4.1050e-02, 6.1135e-02, 1.0000e-04, 4.4018e-02, 4.0721e-02,
         6.2456e-02, 4.3186e-02, 8.2576e-02, 4.2730e-02, 5.0178e-02, 7.8602e-02,
         1.6565e-02, 4.2961e-02, 1.0000e-04, 6.6520e-02, 8.6875e-02, 8.3558e-02,
         5.0106e-02, 1.0720e-01],
        [8.5746e-02, 2.1222e-02, 5.6706e-02, 1.0000e-04, 5.6733e-02, 3.2131e-02,
         6.4546e-02, 1.3793e-02, 3.4105e-02, 5.5539e-02, 2.9710e-02, 1.3829e-01,
         7.1612e-02, 4.9016e-02, 5.6721e-02, 5.5398e-02, 2.4916e-02, 3.4703e-02,
         7.4399e-02, 4.2414e-02],
        [6.3176e-02, 7.7039e-02, 5.3630e-02, 1.0000e-04, 5.0210e-02, 3.8893e-03,
         3.7295e-02, 9.8502e-02, 5.3425e-02, 9.9611e-02, 5.2605e-02, 1.0000e-04,
         5.1401e-02, 7.9043e-02, 3.3797e-02, 8.3999e-02, 9.1422e-02, 5.2531e-02,
         6.0568e-03, 1.2264e-02],
        [5.1963e-02, 7.3183e-02, 4.2308e-02, 8.0613e-02, 9.8569e-02, 6.0712e-02,
         4.6196e-02, 1.2354e-01, 1.0000e-04, 2.1898e-02, 2.1303e-02, 6.3030e-02,
         1.0000e-04, 1.0000e-04, 6.0643e-02, 1.1160e-01, 5.4059e-02, 8.1151e-02,
         1.0000e-04, 8.4840e-03],
        [5.0861e-02, 7.3319e-02, 1.9868e-02, 7.1851e-02, 8.2895e-03, 5.9876e-02,
         3.3664e-02, 5.2941e-02, 1.0302e-01, 4.9526e-02, 4.4129e-02, 1.1730e-02,
         3.8769e-02, 9.4117e-02, 6.6891e-03, 8.7435e-02, 1.6228e-02, 9.8257e-02,
         6.1247e-02, 1.8401e-02]])

sample_index = np.argmax(probs, axis=1)

sample_probs = torch.FloatTensor([[1 / 20] * 20] * 8) 
prompts_dist = torch.distributions.Categorical(sample_probs)
sample_index = prompts_dist.sample()
knowledge_dataset = KnowledgeDataset("datasets/gsm8k_/deepseek/gsm8k_pool_20.json")

print(sample_index)
for i in sample_index:
    print(f"Question: {knowledge_dataset[i]['Question']}")
    print(f"{knowledge_dataset[i]['Rationale']} The answer is {knowledge_dataset[i]['Ground_truth']}.\n")
